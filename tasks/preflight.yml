---
- name: "Check if installed Python3 version is 3.8+."
  ansible.builtin.command:
    cmd: "{{ netbox_python_path }} --version"
  register: "__netbox_python_version"
  changed_when: false
  failed_when: >
    __netbox_python_version.rc != 0 or
    __netbox_python_version.stdout | replace('Python ', '') is version('3.8', '<')

- name: "Create system group."
  become: true
  ansible.builtin.group:
    name: "{{ netbox_group }}"
    system: true
    state: "present"

- name: "Create system user."
  become: true
  ansible.builtin.user:
    name: "{{ netbox_user }}"
    group: "{{ netbox_group }}"
    system: true
    home: "{{ netbox_path }}"
    # shell: "/sbin/nologin"
    shell: "/bin/bash"
    state: "present"

- name: "Create application dir."
  become: true
  ansible.builtin.file:
    path: "{{ netbox_path }}"
    owner: "{{ netbox_user }}"
    group: "{{ netbox_group }}"
    mode: "0755"
